<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Banerjee Stores</title>
  <link rel="stylesheet" href="style.css"/>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>

  <!-- ðŸ”— Injected Header -->
  <div id="header-container"></div>

  <!-- ðŸ§­ Category Bar (fetched from Firestore) -->
  <div class="category-bar" id="categoryBar">
    <!-- Category buttons will be injected here -->
  </div>

  <!-- ðŸ›ï¸ Products Display Section -->
  <section class="products-section" id="productList">
    <!-- Products will be loaded here from Firestore -->
  </section>

  <!-- ðŸ”Œ Firebase Config -->
  <script type="module" src="firebase-config.js"></script>

  <!-- ðŸš€ Dynamic Script -->
  <script type="module">
    import { db } from "./firebase-config.js";
    import { collection, getDocs, query } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Inject header
    fetch("header.html")
      .then(res => res.text())
      .then(data => {
        document.getElementById("header-container").innerHTML = data;
      });

    const productList = document.getElementById("productList");
    const categoryBar = document.getElementById("categoryBar");

    let allProducts = [];

    // Fetch Products
    async function fetchProducts() {
      const q = query(collection(db, "products"));
      const querySnapshot = await getDocs(q);

      allProducts = [];
      let categorySet = new Set();

      querySnapshot.forEach((doc) => {
        const data = doc.data();
        allProducts.push(data);
        categorySet.add(data.category);
      });

      renderCategories([...categorySet]);
      renderProducts(allProducts); // Show all on default
    }

    // Render Products
    function renderProducts(products) {
      productList.innerHTML = "";

      if (products.length === 0) {
        productList.innerHTML = "<p>No products available.</p>";
        return;
      }

      products.forEach((product) => {
        const card = document.createElement("div");
        card.className = "product-card";
        card.innerHTML = `
          <div class="product-img">
            <img src="${product.imageURL}" alt="${product.name}" />
          </div>
          <div class="product-info">
            <h3>${product.name}</h3>
            <p>Category: ${product.category}</p>
            <p>Unit: ${product.unit}</p>
            <p>Price: â‚¹${product.price}</p>
            <button>Add to Cart</button>
          </div>
        `;
        productList.appendChild(card);
      });
    }

    // Render Category Buttons
    function renderCategories(categories) {
      categoryBar.innerHTML = "";

      const allBtn = document.createElement("button");
      allBtn.textContent = "All";
      allBtn.dataset.category = "All";
      allBtn.addEventListener("click", () => renderProducts(allProducts));
      categoryBar.appendChild(allBtn);

      categories.forEach((cat) => {
        const btn = document.createElement("button");
        btn.textContent = cat;
        btn.dataset.category = cat;
        btn.addEventListener("click", () => {
          const filtered = allProducts.filter(p => p.category === cat);
          renderProducts(filtered);
        });
        categoryBar.appendChild(btn);
      });
    }

    // Load Everything
    fetchProducts();
  </script>

</body>
</html>
